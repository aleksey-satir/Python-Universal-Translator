#!/usr/bin/python3.9
import sys
import yaml
from transPYler import core
from jinja2 import Template


yaml.warnings({'YAMLLoadWarning': False})

conf = yaml.load(open('build.tp', 'r').read())

for i in conf.get('templates'):
    tmpls = yaml.load(open(i, 'r').read())
    for i in tmpls:
        if i not in ['operations', 'types']:
            tmpls[i] = Template(tmpls.get(i))
    core.tmpls |= tmpls

if 'macros' in conf:
    core.macros |= yaml.load(open(conf.get('macros')[0], 'r').read())

if 'file' in conf:
    out_file = open(conf.get('file'), 'w')
else:
    out_file = sys.stdout
print(core.compiler(open(sys.argv[1], 'r').read()), file=out_file)
